<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rerddap">
<title>Using rerddap to Access Data from ERDDAP Servers • rerddap</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using rerddap to Access Data from ERDDAP Servers">
<meta property="og:description" content="rerddap">
<meta property="og:image" content="https://docs.ropensci.org/rerddap/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">rerddap</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../articles/rerddap.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Using_rerddap.html">Using rerddap to Access Data from ERDDAP Servers</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/rerddap/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Using rerddap to Access Data from ERDDAP Servers</h1>
                        <h4 data-toc-skip class="author">Roy Mendelssohn and Scott Chamberlain</h4>
            
            <h4 data-toc-skip class="date">2024-03-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/rerddap/blob/HEAD/vignettes/Using_rerddap.Rmd" class="external-link"><code>vignettes/Using_rerddap.Rmd</code></a></small>
      <div class="d-none name"><code>Using_rerddap.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>rerddap</code> is a general purpose <span style="color:red">R</span> client for working with <span style="color:red">ERDDAP</span> servers. <span style="color:red">ERDDAP</span> is a web service developed by Bob Simons of NOAA. At the time of this writing, there are over sixty <span style="color:red">ERDDAP</span> servers (though not all are public facing) providing access to literally petabytes of data and model output relevant to oceanography, meteorology, fisheries and marine mammals, among other areas. <span style="color:red">ERDDAP</span> is a simple to use, RESTful web service, that allows data to be subsetted and returned in a variety of formats.</p>
<p>This vignette goes over some of the nuts and bolts of using the <code>rerddap</code> package, and shows the power of the combination of the <code>rerddap</code> package with <span style="color:red">ERDDAP</span> servers. Some of the examples are taken from the <code>xtractomatic</code> package (available from CRAN - <a href="https://cran.r-project.org/package=xtractomatic" class="external-link uri">https://cran.r-project.org/package=xtractomatic</a>), and some from the <code>rerddapXtracto</code> package available on Github (<a href="https://github.com/rmendels/rerddapXtracto" class="external-link uri">https://github.com/rmendels/rerddapXtracto</a>), but reworked to use <code>rerddap</code> directly. Other examples are new to this vignette, and include both gridded and non-gridded datasets from several <span style="color:red">ERDDAPs</span>.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The first step is to install the <code>rerddap</code> package, the stable version is available from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"rerddap"</span><span class="op">)</span></span></code></pre></div>
<p>or the development version can be installed from GitHub:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"ropensci/rerddap"</span><span class="op">)</span></span></code></pre></div>
<p>and to load the library:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/rerddap/">"rerddap"</a></span><span class="op">)</span></span></code></pre></div>
<p>Besides <code>rerddap</code> the following libraries are used in this vignette:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"akima"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org" class="external-link">"dplyr"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"mapdata"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://cirrus.ucsd.edu/~pierce/ncdf/" class="external-link">"ncdf4"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"plot3D"</span><span class="op">)</span></span></code></pre></div>
<p>Code chunks are always given with the required libraries so that the chunks are more standalone in nature. Many of the plots use an early version of the <code>cmocean</code> colormaps designed by Kristen Thyng (see <a href="https://matplotlib.org/cmocean/" class="external-link uri">https://matplotlib.org/cmocean/</a> and <a href="https://github.com/matplotlib/cmocean" class="external-link uri">https://github.com/matplotlib/cmocean</a>) translatd from the original Python implementation. However, there is now a <code>cmocean</code> package for <span style="color:red">R</span>. As past scripts may use the built-in color palette it is maintained here, but use of the <code>cmocean</code> package is advisable as it is kept up-to-date. In the present version of the <code>cmocean</code> package the names have changed, what is “temperature” here is now “thermal”, “chlorophyll” is now “algae”, and “salinity” is now “haline”.</p>
</div>
<div class="section level2">
<h2 id="the-main-rerddap-functions">The main <code>rerddap</code> functions<a class="anchor" aria-label="anchor" href="#the-main-rerddap-functions"></a>
</h2>
<p>The complete list of rerddap functions can be seen by looking at he <code>rerddap</code> package help:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">rerddap</span></span></code></pre></div>
<p>and selecting the index of the package. The main functions used here are:</p>
<ul>
<li>the list of servers <code>rerddap</code> knows about - <code>server()</code>
</li>
<li>search an <span style="color:red">ERDDAP</span> server for terms - <code>ed_search(query, page = NULL, page_size = NULL, which = "griddap", url = eurl(), ...)</code>
</li>
<li>search a list of <span style="color:red">ERDDAP</span> servers for terms - <code>global_search(query, server_list, which_service)</code>
</li>
<li>get a list of datasets on an <span style="color:red">ERDDAP</span> server - <code>ed_datasets(which = "tabledap", url = eurl())</code>
</li>
<li>obtain information about a dataset - <code>info(datasetid, url = eurl(), ...)</code>
</li>
<li>extract data from a griddap dataset - <code>griddap(x, ..., fields = "all", stride = 1, fmt = "nc", url = eurl(), store = disk(), read = TRUE, callopts = list())</code>
</li>
<li>extract data from a tabledap dataset - <code>tabledap(x, ..., fields = NULL, distinct = FALSE, orderby = NULL, orderbymax = NULL, orderbymin = NULL, orderbyminmax = NULL, units = NULL, url = eurl(), store = disk(), callopts = list())</code>
</li>
</ul>
<p>Be careful when using the functions <code><a href="../reference/ed_search.html">ed_search()</a></code>, <code><a href="../reference/ed_search.html">ed_datasets()</a></code> and <code><a href="../reference/global_search.html">global_search()</a></code>. The default <span style="color:red">ERDDAP</span> has over 9,000 datasets, most of which are grids, so that a list of all the gridded datasets can be quite long. A seemly reasonable search:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">whichSST</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ed_search.html">ed_search</a></span><span class="op">(</span>query <span class="op">=</span> <span class="st">"SST"</span><span class="op">)</span></span></code></pre></div>
<p>returns about 1000 responses. The more focused query:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">whichSST</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ed_search.html">ed_search</a></span><span class="op">(</span>query <span class="op">=</span> <span class="st">"SST MODIS"</span><span class="op">)</span></span></code></pre></div>
<p>still returns 172 responses. If the simple search doesn’t narrow things enough, look at the advanced search function <code><a href="../reference/ed_search_adv.html">ed_search_adv()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="finding-the-data-you-want">Finding the Data You Want<a class="anchor" aria-label="anchor" href="#finding-the-data-you-want"></a>
</h2>
<p>The first way to find a dataset is to browse the builtin web page for a particular <span style="color:red">ERDDAP</span> server. A list of some of the public available <span style="color:red">ERDDAP</span> servers can be obtained from the <code>rerddap</code> command:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/servers.html">servers</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 62 × 4</span></span></span>
<span><span class="co">#&gt;    name                                                  short_name url   public</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Voice of the Ocean                                    VOTO       http… TRUE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> St. Lawrence Global Observatory - CIOOS | Observatoi… SLGO-OGSL  http… TRUE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> CoastWatch West Coast Node                            CSWC       http… TRUE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ERDDAP at the Asia-Pacific Data-Research Center       APDRC      http… TRUE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> NOAA's National Centers for Environmental Informatio… NCEI       http… TRUE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Biological and Chemical Oceanography Data Management… BCODMO     http… TRUE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> European Marine Observation and Data Network (EMODne… EMODnet    http… TRUE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> European Marine Observation and Data Network (EMODne… EMODnet P… http… TRUE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Marine Institute - Ireland                            MII        http… TRUE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> CoastWatch Caribbean/Gulf of Mexico Node              CSCGOM     http… TRUE  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 52 more rows</span></span></span></code></pre></div>
<p>The list of <span style="color:red">ERDDAP</span> servers is based on the list maintained at the <em>Awesome ERDDAP</em> site compiled by the Irish Marine Institute.</p>
<p>The second way to find and obtain the desired data is to use functions in <code>rerddap</code>. The basic steps are:</p>
<ol style="list-style-type: decimal">
<li>Find the dataset on an <span style="color:red">ERDDAP</span> server (<code><a href="../reference/servers.html">rerddap::servers()</a></code>, <code><a href="../reference/ed_search.html">rerddap::ed_search()</a></code>, <code><a href="../reference/ed_search.html">rerddap::ed_datasets()</a></code> ).</li>
<li>Get the needed information about the dataset (<code><a href="../reference/info.html">rerddap::info()</a></code> )</li>
<li>Think about what you are going to do.</li>
<li>Make the request for the data (<code><a href="../reference/griddap.html">rerddap::griddap()</a></code> or <code><a href="../reference/tabledap.html">rerddap::tabledap()</a></code> ).</li>
</ol>
<p>We discuss each of these steps in more detail, and then look at some realistic uses of the package.</p>
<div class="section level3">
<h3 id="think-about-what-you-are-going-to-do-">Think about what you are going to do.<a class="anchor" aria-label="anchor" href="#think-about-what-you-are-going-to-do-"></a>
</h3>
<p>This may seem to be a strange step in the process, but it is important because many of the datasets are high-resolution, and data requests can get very large, very quickly. As an example, based on a real use case. The MUR SST ( Multi-scale Ultra-high Resolution (MUR) SST Analysis fv04.1, see <a href="https://coastwatch.pfeg.noaa.gov/erddap/griddap/jplMURSST41.html" class="external-link uri">https://coastwatch.pfeg.noaa.gov/erddap/griddap/jplMURSST41.html</a> ) is a daily, high-quality, high-resolution sea surface temperature product. The user wanted the MUR data for a 2x2-degree box, daily for a year. That seems innocuous enough. Except that MURsst is at a one-hundreth of degree resolution. If we assume just a binary representation of the data, assuming 8-bytes per value, and do the math:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">100</span><span class="op">*</span><span class="fl">100</span><span class="op">*</span><span class="fl">4</span><span class="op">*</span><span class="fl">8</span><span class="op">*</span><span class="fl">365</span></span>
<span><span class="co">#&gt; [1] 116800000</span></span></code></pre></div>
<p>Yes, 116,800,000 bytes or roughly 115MB for that request. Morever the user wanted the data as a .csv file, which usually makes the resulting file 8-10 times larger, so now we are over a 1GB for the request. Even more so, there are four parameters in that dataset, and in <code><a href="../reference/griddap.html">rerddap::griddap()</a></code> if “fields” is not specified, all fields are downloaded, therefore the resulting files will be four times as large as given above.</p>
<p>So the gist of this is to think about your request before you make it. Do a little mental math to get a rough estimate of the size of the download. There are times receiving the data as a .csv file is convenient, but make certain the request will not be too large. For larger requests, obtain the data as netCDF files. By default, <code><a href="../reference/griddap.html">rerddap::griddap()</a></code> “melts”” the data into a dataframe, so a .csv only provides a small convenience. But for really large downloads, you should select the option in <code><a href="../reference/griddap.html">rerddap::griddap()</a></code> to not read in the data, and use instead the <code>netcdf4</code> package to read in the data, as this allows for only reading in parts of the data at a time. <a href="#ncdf4">Below</a> we provide a brief tutorial on reading in data using the <code>ncdf4</code> package.</p>
</div>
</div>
<div class="section level2">
<h2 id="some-erddap-basics">Some ERDDAP Basics<a class="anchor" aria-label="anchor" href="#some-erddap-basics"></a>
</h2>
<p>One of the main advantages of a service such as <span style="color:red">ERDDAP</span> is that you only need to download the subset of the data you desire, rather than the entire dataset, which is both convenient and essential for large datasets. The underlying data model in <span style="color:red">ERDDAP</span> is quite simple - everything is either a (multi-dimensional) grid (think <span style="color:red">R</span> array) or a table (think a simple spreadsheet or data table). Grids are subsetted using the function <code><a href="../reference/griddap.html">griddap()</a></code> and tables are subset using the function <code><a href="../reference/tabledap.html">tabledap()</a></code>.</p>
<p>If you know the datasetID of the data you are after, and are unsure if it is a grid or a table, there are several ways to find out. We will look at two datasets, ‘jplMURSST41’ and ‘siocalcofiHydroCasts’. The first method is to use the <code>rerddap</code> function <code><a href="../reference/browse.html">browse()</a></code></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/browse.html">browse</a></span><span class="op">(</span><span class="st">'jplMURSST41'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/browse.html">browse</a></span><span class="op">(</span><span class="st">'siocalcofiHydroCast'</span><span class="op">)</span></span></code></pre></div>
<p>which brings up information on the datasets in the browser, in the first case the “data” link is under “griddap”, the second is under “tabledap”.</p>
<p>The other method is to use the <code>rerddap</code> function <code>info</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/info.html">info</a></span><span class="op">(</span><span class="st">'jplMURSST41'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/info.html">info</a></span><span class="op">(</span><span class="st">'siocalcofiHydroCast'</span><span class="op">)</span></span></code></pre></div>
<p>Notice the information on ‘jplMURSST41’ lists the dimensions (that is a grid) while that of ‘siocalcofiHydroCasts’ does not (that is a table).</p>
<div class="section level3">
<h3 id="subsetting-griddap">Subsetting griddap()<a class="anchor" aria-label="anchor" href="#subsetting-griddap"></a>
</h3>
<p>Like an <span style="color:red">R</span> array, <span style="color:red">ERDDAP</span> grids are subsetted by setting limits on the dimension variables, the difference being that a subset is defined in coordinate space (latitude values, longitude values, time values) rather than array space as is done with <span style="color:red">R</span> arrays. Thus for ‘jplMURSST41’ if the desired area of the data extract is latitude limits of (22N, 51N), longitude limits of (140W, 105W), and with time limits of (2017-01-01, 2017-01-02) the following would be passed to the function <code><a href="../reference/griddap.html">griddap()</a></code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">latitude</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">22.</span>, <span class="fl">51.</span><span class="op">)</span></span>
<span><span class="va">longitude</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">140.</span>, <span class="op">-</span><span class="fl">105</span><span class="op">)</span></span>
<span><span class="va">time</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2017-01-01"</span>, <span class="st">"2017-01-02"</span><span class="op">)</span></span></code></pre></div>
<p>A full <code><a href="../reference/griddap.html">griddap()</a></code> request to retrieve “analysed_sst” with these constraints would be:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sstInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/info.html">info</a></span><span class="op">(</span><span class="st">'jplMURSST41'</span><span class="op">)</span></span>
<span><span class="va">murSST</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/griddap.html">griddap</a></span><span class="op">(</span><span class="va">sstInfo</span>, latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">22.</span>, <span class="fl">51.</span><span class="op">)</span>, longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">140.</span>, <span class="op">-</span><span class="fl">105</span><span class="op">)</span>, time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2017-01-01"</span>, <span class="st">"2017-01-02"</span><span class="op">)</span>, fields <span class="op">=</span> <span class="st">'analysed_sst'</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="strides">Strides<a class="anchor" aria-label="anchor" href="#strides"></a>
</h4>
<p>Strides allow to retrieve data within a coordinate bound only at every “n” values, where “n” is an integer - think of the “by” part of the <span style="color:red">R</span> function <code><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq()</a></code>. This is useful say for a monthly dataset where only the December values are desired, or you want to subsample a very high resolution dataset. The default is a stride of 1 for all dimensions. If you want to change the stride value in any dimension, then the value must be given for all dimensions. So in the previous example, if only every fifth longitude is desired, the call would be:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">murSST</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/griddap.html">griddap</a></span><span class="op">(</span><span class="va">sstInfo</span>, latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">22.</span>, <span class="fl">51.</span><span class="op">)</span>, longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">140.</span>, <span class="op">-</span><span class="fl">105</span><span class="op">)</span>, time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2017-01-01"</span>, <span class="st">"2017-01-02"</span><span class="op">)</span>, stride <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span>, fields <span class="op">=</span> <span class="st">'analysed_sst'</span><span class="op">)</span></span></code></pre></div>
<p>Strides are done in array space, not in coordinate space - so it is not skipping say a number of degrees of longitude, but is skipping a number of values of the array index - if longitude is thought of as an array, then every fifth value is used. There are many cases where having strides work in coordinate space would be handy, but it can cause a lot of problems. Consider the case where neither the starting longitude, nor the ending longitude in the request lie on the actual data grid, and the stride is in coordinate units in such a way that no value requested actually lies on an actual grid value. This would be equivalent to the more complicated problem of data regridding and data interpolation.</p>
<p>When <span style="color:red">ERDDAP</span> receives a request where the bounds are not on the actual dataset grid, <span style="color:red">ERDDAP</span> finds the closest values on the grid to the requested bounds, and returns those points and all grid points in between. If a stride is added of a value greater than one but resricted to array space, this guarantees that every value returned lies on the dataset grid.</p>
</div>
</div>
<div class="section level3">
<h3 id="subsetting-tabledap">Subsetting tabledap()<a class="anchor" aria-label="anchor" href="#subsetting-tabledap"></a>
</h3>
<p>Tables in <span style="color:red">ERDDAP</span> are subset by using “constraint expressions” on any variable in the table. The valid operators are =, != (not equals), =~ (a regular expression test), &lt;, &lt;=, &gt;, and &gt;=. The constraint is constructed as the parameter on the left, value on the right, and the operator in the middle, all within a set of quotes. For example, if in the SWFSC/FRD trawl catch data (datasetID ‘FRDCPSTrawlLHHaulCatch’), only sardines for 2010 were desired, the following constraints would be set in the <code><a href="../reference/tabledap.html">tabledap()</a></code> call:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="st">'time&gt;=2010-01-01'</span></span>
<span><span class="st">'time&lt;=2010-12-31'</span></span>
<span><span class="st">'scientific_name="Sardinops sagax"'</span></span></code></pre></div>
<p>Note that in <code><a href="../reference/tabledap.html">tabledap()</a></code> character strings usually must be passed as “double-quoted”, as seen in the example with the scientific name. A full <code><a href="../reference/tabledap.html">tabledap()</a></code> request to retrieve ‘latitude’, ‘longitude’, ‘time’, ‘scientific_name’, and ‘subsample_count’ with these constraints would be:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CPSinfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/info.html">info</a></span><span class="op">(</span><span class="st">'FRDCPSTrawlLHHaulCatch'</span><span class="op">)</span></span>
<span><span class="va">sardines</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tabledap.html">tabledap</a></span><span class="op">(</span><span class="va">CPSinfo</span>, fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'latitude'</span>,  <span class="st">'longitude'</span>, <span class="st">'time'</span>, <span class="st">'scientific_name'</span>, <span class="st">'subsample_count'</span><span class="op">)</span>, <span class="st">'time&gt;=2010-01-01'</span>, <span class="st">'time&lt;=2010-12-31'</span>, <span class="st">'scientific_name="Sardinops sagax"'</span> <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="searching">Searching<a class="anchor" aria-label="anchor" href="#searching"></a>
</h2>
<p>The functions in <code>rerddap</code> work with any <span style="color:red">ERDDAP</span> server as long as the base URL is provided. A list of advertised <span style="color:red">ERDDAP</span> servers is provided by the Irish Marine Institute’s <em>Awesome ERDDAP</em> web page, and the <code>rerddap</code> function <code><a href="../reference/servers.html">servers()</a></code> will download this list.</p>
<p>Given a base <span style="color:red">ERDDAP</span> URL, the function <code><a href="../reference/ed_search.html">ed_search()</a></code> will search the server for the given search terms. The default <span style="color:red">ERDDAP</span> server is <a href="https://upwell.pfeg.noaa.gov/erddap/" class="external-link uri">https://upwell.pfeg.noaa.gov/erddap/</a>. Alternately, the function <code><a href="../reference/global_search.html">global_search()</a></code> will search a list of <span style="color:red">ERDDAP</span> servers for the given search terms. The function <code><a href="../reference/ed_search.html">ed_datasets()</a></code> lists the datasets available from the given <span style="color:red">ERDDAP</span> server.</p>
</div>
<div class="section level2">
<h2 id="griddap">griddap<a class="anchor" aria-label="anchor" href="#griddap"></a>
</h2>
<div class="section level3">
<h3 id="mur-sst">MUR SST<a class="anchor" aria-label="anchor" href="#mur-sst"></a>
</h3>
<p>MUR (Multi-scale Ultra-high Resolution) is an analyzed SST product at 0.01-degree resolution going back to 2002, providing one of the longest satellite based time series at such high resolution (see <a href="https://podaac.jpl.nasa.gov/dataset/MUR-JPL-L4-GLOB-v4.1" class="external-link uri">https://podaac.jpl.nasa.gov/dataset/MUR-JPL-L4-GLOB-v4.1</a>). The latest data available for a region off the west coast can be extracted and plotted by:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st">"mapdata"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/rerddap/">"rerddap"</a></span><span class="op">)</span></span>
<span><span class="va">sstInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/info.html">info</a></span><span class="op">(</span><span class="st">'jplMURSST41'</span><span class="op">)</span></span>
<span><span class="co"># get latest daily sst</span></span>
<span><span class="va">murSST</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/griddap.html">griddap</a></span><span class="op">(</span><span class="va">sstInfo</span>, latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">22.</span>, <span class="fl">51.</span><span class="op">)</span>, longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">140.</span>, <span class="op">-</span><span class="fl">105</span><span class="op">)</span>, time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'last'</span>,<span class="st">'last'</span><span class="op">)</span>, fields <span class="op">=</span> <span class="st">'analysed_sst'</span><span class="op">)</span></span>
<span><span class="va">mycolor</span> <span class="op">&lt;-</span> <span class="va">colors</span><span class="op">$</span><span class="va">temperature</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">"worldHires"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">22.</span>, <span class="fl">51.</span><span class="op">)</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">140</span>, <span class="op">-</span><span class="fl">105</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">murSST</span><span class="op">$</span><span class="va">data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span>, fill <span class="op">=</span> <span class="va">analysed_sst</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="va">w</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_raster</span><span class="op">(</span>interpolate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_fill_gradientn</span><span class="op">(</span>colours <span class="op">=</span> <span class="va">mycolor</span>, na.value <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"latitude"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"longitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_fixed</span><span class="op">(</span><span class="fl">1.3</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">140</span>, <span class="op">-</span><span class="fl">105</span><span class="op">)</span>,  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">22.</span>, <span class="fl">51.</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Latest MUR SST"</span><span class="op">)</span></span></code></pre></div>
<p><img src="MUR_sst.png"></p>
</div>
<div class="section level3">
<h3 id="viirs-sst-and-chlorophyll">VIIRS SST and Chlorophyll<a class="anchor" aria-label="anchor" href="#viirs-sst-and-chlorophyll"></a>
</h3>
<p>VIIRS (Visible Infrared Imaging Radiometer Suite) is a scanning radiometer, that collects visible and infrared imagery and radiometric measurements of the land, atmosphere, cryosphere, and oceans. VIIRS data is used to measure cloud and aerosol properties, ocean color, sea and land surface temperature, ice motion and temperature, fires, and Earth’s albedo. Both NASA and NOAA provide VIIRS-based high resolution SST and chlorophyll products.</p>
<p>ERD provides a 3-day composite SST product at 750 meter resolution developed from a real-time NOAA product. The most recent values can be obtained by setting “time” to be “last”. (Note that <span style="color:red">R</span> sees the latitude-longitude grid as slightly uneven (even though it is in fact even), and that produces artificial lines in <code>ggplot2::geom_raster()</code>. In order to remove those lines, the latitude-longitude grid is remapped to an evenly-space grid.)</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st">"mapdata"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/rerddap/">"rerddap"</a></span><span class="op">)</span></span>
<span><span class="va">sstInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/info.html">info</a></span><span class="op">(</span><span class="st">'erdVHsstaWS3day'</span><span class="op">)</span></span>
<span><span class="co"># get latest 3-day composite sst</span></span>
<span><span class="va">viirsSST</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/griddap.html">griddap</a></span><span class="op">(</span><span class="va">sstInfo</span>, latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">41.</span>, <span class="fl">31.</span><span class="op">)</span>, longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">128.</span>, <span class="op">-</span><span class="fl">115</span><span class="op">)</span>, time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'last'</span>,<span class="st">'last'</span><span class="op">)</span>, fields <span class="op">=</span> <span class="st">'sst'</span><span class="op">)</span></span>
<span><span class="co"># remap latitiudes and longitudes to even grid</span></span>
<span><span class="va">myLats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">viirsSST</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">latitude</span><span class="op">)</span></span>
<span><span class="va">myLons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">viirsSST</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">longitude</span><span class="op">)</span></span>
<span><span class="va">myLats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">myLats</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">myLats</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">myLats</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">myLons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">myLons</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">myLons</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">myLons</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># melt these out to full grid</span></span>
<span><span class="va">mapFrame</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">myLons</span>, y <span class="op">=</span> <span class="va">myLats</span><span class="op">)</span></span>
<span><span class="va">mapFrame</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">mapFrame</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co"># form a frame with the new values and the data</span></span>
<span><span class="va">tempFrame</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sst <span class="op">=</span> <span class="va">viirsSST</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">sst</span>, lat <span class="op">=</span> <span class="va">mapFrame</span><span class="op">$</span><span class="va">y</span>, lon <span class="op">=</span> <span class="va">mapFrame</span><span class="op">$</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">mycolor</span> <span class="op">&lt;-</span> <span class="va">colors</span><span class="op">$</span><span class="va">temperature</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">"worldHires"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30.</span>, <span class="fl">42.</span><span class="op">)</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">128</span>, <span class="op">-</span><span class="fl">114</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">tempFrame</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>, y <span class="op">=</span> <span class="va">lat</span>, fill <span class="op">=</span> <span class="va">sst</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="va">w</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_raster</span><span class="op">(</span>interpolate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_fill_gradientn</span><span class="op">(</span>colours <span class="op">=</span> <span class="va">mycolor</span>, na.value <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"latitude"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"longitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_fixed</span><span class="op">(</span><span class="fl">1.3</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">128</span>, <span class="op">-</span><span class="fl">114</span><span class="op">)</span>,  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30.</span>, <span class="fl">42.</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Latest VIIRS 3-day SST"</span><span class="op">)</span></span></code></pre></div>
<p><img src="VIIRS_sst.png"></p>
<p>A time series from the same dataset at a given location, here (36., -126.):</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/rerddap/">"rerddap"</a></span><span class="op">)</span></span>
<span><span class="va">viirsSST1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/griddap.html">griddap</a></span><span class="op">(</span><span class="va">sstInfo</span>, latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">36.</span>, <span class="fl">36.</span><span class="op">)</span>, </span>
<span>                     longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">126.</span>, <span class="op">-</span><span class="fl">126.</span><span class="op">)</span>, </span>
<span>                     time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'2015-01-01'</span>,<span class="st">'2015-12-31'</span><span class="op">)</span>, fields <span class="op">=</span> <span class="st">'sst'</span><span class="op">)</span></span>
<span><span class="va">tempTime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">viirsSST1</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">time</span>, origin <span class="op">=</span> <span class="st">'1970-01-01'</span>, tz <span class="op">=</span> <span class="st">"GMT"</span><span class="op">)</span></span>
<span><span class="va">tempFrame</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>time <span class="op">=</span> <span class="va">tempTime</span>, sst <span class="op">=</span> <span class="va">viirsSST1</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">sst</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">tempFrame</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">time</span>, <span class="va">sst</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"sst"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"VIIRS SST at (36N, 126W)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="VIIRS_sst_series.png"></p>
<p>A similar 3-day composite for chloropyll for the same region from a scientific quality product developed by NOAA:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st">"mapdata"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/rerddap/">"rerddap"</a></span><span class="op">)</span></span>
<span><span class="va">chlaInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/info.html">info</a></span><span class="op">(</span><span class="st">'erdVHNchla3day'</span><span class="op">)</span></span>
<span><span class="va">viirsCHLA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/griddap.html">griddap</a></span><span class="op">(</span><span class="va">chlaInfo</span>, latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">41.</span>, <span class="fl">31.</span><span class="op">)</span>, </span>
<span>                     longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">128.</span>, <span class="op">-</span><span class="fl">115</span><span class="op">)</span>, time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'last'</span>,<span class="st">'last'</span><span class="op">)</span>, </span>
<span>                     fields <span class="op">=</span> <span class="st">'chla'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mycolor</span> <span class="op">&lt;-</span> <span class="va">colors</span><span class="op">$</span><span class="va">chlorophyll</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">"worldHires"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30.</span>, <span class="fl">42.</span><span class="op">)</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">128</span>, <span class="op">-</span><span class="fl">114</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">viirsCHLA</span><span class="op">$</span><span class="va">data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">chla</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="va">w</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>interpolate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>colours <span class="op">=</span> <span class="va">mycolor</span>, na.value <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"latitude"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"longitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_fixed</span><span class="op">(</span><span class="fl">1.3</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">128</span>, <span class="op">-</span><span class="fl">114</span><span class="op">)</span>,  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30.</span>, <span class="fl">42.</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Latest VIIRS 3-day Chla"</span><span class="op">)</span></span></code></pre></div>
<p><img src="VIIRS_chla.png"></p>
</div>
<div class="section level3">
<h3 id="temperature-at-70m-in-the-north-pacific-from-the-soda-model-output">Temperature at 70m in the north Pacific from the SODA model output<a class="anchor" aria-label="anchor" href="#temperature-at-70m-in-the-north-pacific-from-the-soda-model-output"></a>
</h3>
<p>This is an example of an extract from a 4-D dataset (results from the “Simple Ocean Data Assimilation (SODA)” model - see <a href="https://www2.atmos.umd.edu/~ocean/" class="external-link uri">https://www2.atmos.umd.edu/~ocean/</a>), and illustrate the case where the z-coordinate does not have the default name “altitude”. Water temperature at 70m depth is extracted for the North Pacific Ocean.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/rerddap/">"rerddap"</a></span><span class="op">)</span></span>
<span><span class="va">dataInfo</span> <span class="op">&lt;-</span> <span class="fu">rerddap</span><span class="fu">::</span><span class="fu"><a href="../reference/info.html">info</a></span><span class="op">(</span><span class="st">'hawaii_d90f_20ee_c4cb'</span><span class="op">)</span></span>
<span><span class="va">xpos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">135.25</span>, <span class="fl">240.25</span><span class="op">)</span></span>
<span><span class="va">ypos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20.25</span>, <span class="fl">60.25</span><span class="op">)</span></span>
<span><span class="va">zpos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">70.02</span>, <span class="fl">70.02</span><span class="op">)</span></span>
<span><span class="va">tpos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'2010-12-15'</span>, <span class="st">'2010-12-15'</span><span class="op">)</span></span>
<span><span class="va">soda70</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/griddap.html">griddap</a></span><span class="op">(</span><span class="va">dataInfo</span>,  longitude <span class="op">=</span> <span class="va">xpos</span>, latitude <span class="op">=</span> <span class="va">ypos</span>, </span>
<span>                  time <span class="op">=</span> <span class="va">tpos</span>, depth <span class="op">=</span> <span class="va">zpos</span>, fields <span class="op">=</span> <span class="st">'temp'</span> <span class="op">)</span></span></code></pre></div>
<p>Since the data cross the dateline, it is necessary to use the new “world2Hires” continental outlines in the package <code>mapdata</code> which is Pacific Ocean centered. Unfortunatley there is a small problem where the outlines from certain countries wrap and mistakenly appear in plots, and those countries must be removed, see code below.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st">"mapdata"</span><span class="op">)</span></span>
<span><span class="va">xlim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">135</span>, <span class="fl">240</span><span class="op">)</span></span>
<span><span class="va">ylim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">60</span><span class="op">)</span></span>
<span><span class="va">my.col</span> <span class="op">&lt;-</span> <span class="va">colors</span><span class="op">$</span><span class="va">temperature</span></span>
<span><span class="co">## Must do a kludge to remove countries that wrap and mess up the plot</span></span>
<span><span class="va">w1</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span><span class="st">"world2Hires"</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">135</span>, <span class="fl">240</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">60</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">TRUE</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">remove</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UK:Great Britain"</span>, <span class="st">"France"</span>, <span class="st">"Spain"</span>, <span class="st">"Algeria"</span>, <span class="st">"Mali"</span>, <span class="st">"Burkina Faso"</span>, <span class="st">"Ghana"</span>, <span class="st">"Togo"</span><span class="op">)</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">"world2Hires"</span>, regions <span class="op">=</span> <span class="va">w1</span><span class="op">$</span><span class="va">names</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">w1</span><span class="op">$</span><span class="va">names</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">remove</span><span class="op">)</span><span class="op">]</span>, ylim <span class="op">=</span> <span class="va">ylim</span>, xlim <span class="op">=</span> <span class="va">xlim</span><span class="op">)</span></span>
<span><span class="va">myplot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">soda70</span><span class="op">$</span><span class="va">data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span>, fill <span class="op">=</span> <span class="va">temp</span><span class="op">)</span>, interpolate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="va">w</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_fill_gradientn</span><span class="op">(</span>colours <span class="op">=</span> <span class="va">my.col</span>, na.value <span class="op">=</span> <span class="cn">NA</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">30</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"temperature"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"latitude"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"longitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_fixed</span><span class="op">(</span><span class="fl">1.3</span>, xlim <span class="op">=</span> <span class="va">xlim</span>, ylim <span class="op">=</span> <span class="va">ylim</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"70m temperature "</span>, <span class="va">soda70</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">time</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">myplot</span></span></code></pre></div>
<p><img src="soda70.png"></p>
</div>
<div class="section level3">
<h3 id="hourly">Irish Marine Institute<a class="anchor" aria-label="anchor" href="#hourly"></a>
</h3>
<p>The Irish Marine Institute has an <span style="color:red">ERDDAP</span> server at <a href="https://erddap.marine.ie/erddap" class="external-link uri">https://erddap.marine.ie/erddap</a>. Among other datasets, they have hourly output from a model of the North Altantic ocean, with a variety of ocean related parameters, see the dataset <em>IMI_NEATL</em>. To obtain the latest sea surface salinity for the domain of the model:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/rerddap/">"rerddap"</a></span><span class="op">)</span></span>
<span><span class="va">urlBase</span> <span class="op">&lt;-</span> <span class="st">"https://erddap.marine.ie/erddap/"</span></span>
<span><span class="va">parameter</span> <span class="op">&lt;-</span> <span class="st">"sea_surface_salinity"</span></span>
<span><span class="va">sssTimes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"last"</span>, <span class="st">"last"</span><span class="op">)</span></span>
<span><span class="va">sssLats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">48.00625</span>, <span class="fl">57.50625</span><span class="op">)</span></span>
<span><span class="va">sssLons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">17.99375</span>, <span class="op">-</span><span class="fl">1.00625</span><span class="op">)</span></span>
<span><span class="va">dataInfo</span> <span class="op">&lt;-</span> <span class="fu">rerddap</span><span class="fu">::</span><span class="fu"><a href="../reference/info.html">info</a></span><span class="op">(</span><span class="st">"IMI_NEATL"</span>, url <span class="op">=</span> <span class="va">urlBase</span><span class="op">)</span></span>
<span><span class="va">NAtlSSS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/griddap.html">griddap</a></span><span class="op">(</span><span class="va">dataInfo</span>, longitude <span class="op">=</span> <span class="va">sssLons</span>, latitude <span class="op">=</span> <span class="va">sssLats</span>, time <span class="op">=</span> <span class="va">sssTimes</span>, fields <span class="op">=</span> <span class="va">parameter</span>, url <span class="op">=</span> <span class="va">urlBase</span><span class="op">)</span></span></code></pre></div>
<p>and the extracted data plotted:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st">"mapdata"</span><span class="op">)</span></span>
<span><span class="va">xlim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">17.99375</span>, <span class="op">-</span><span class="fl">1.00625</span><span class="op">)</span></span>
<span><span class="va">ylim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">48.00625</span>, <span class="fl">57.50625</span><span class="op">)</span></span>
<span><span class="va">my.col</span> <span class="op">&lt;-</span> <span class="va">colors</span><span class="op">$</span><span class="va">salinity</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">"worldHires"</span>, ylim <span class="op">=</span> <span class="va">ylim</span>, xlim <span class="op">=</span> <span class="va">xlim</span><span class="op">)</span></span>
<span><span class="va">myplot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">NAtlSSS</span><span class="op">$</span><span class="va">data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span>, fill <span class="op">=</span> <span class="va">sea_surface_salinity</span><span class="op">)</span>, interpolate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="va">w</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_fill_gradientn</span><span class="op">(</span>colours <span class="op">=</span> <span class="va">my.col</span>, na.value <span class="op">=</span> <span class="cn">NA</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">34</span>, <span class="fl">36</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"salinity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"latitude"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"longitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_fixed</span><span class="op">(</span><span class="fl">1.3</span>, xlim <span class="op">=</span> <span class="va">xlim</span>, ylim <span class="op">=</span> <span class="va">ylim</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"salinity"</span>, <span class="va">NAtlSSS</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">time</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">myplot</span></span></code></pre></div>
<p><img src="NAtlSSS.png"></p>
</div>
<div class="section level3">
<h3 id="ifremer">IFREMER<a class="anchor" aria-label="anchor" href="#ifremer"></a>
</h3>
<p>The French agency IFREMER also has an <span style="color:red">ERDDAP</span> server. Here salinity data at 75 meters from “Global Ocean, Coriolis Observation Re-Analysis CORA4.1” model off the west coast of the United States is extracted and plotted.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/rerddap/">"rerddap"</a></span><span class="op">)</span></span>
<span><span class="va">urlBase</span> <span class="op">&lt;-</span> <span class="st">"https://www.ifremer.fr/erddap/"</span></span>
<span><span class="va">parameter</span> <span class="op">&lt;-</span> <span class="st">"PSAL"</span></span>
<span><span class="va">ifrTimes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2019-05-15"</span>, <span class="st">"2019-05-15"</span><span class="op">)</span></span>
<span><span class="va">ifrLats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30.</span>, <span class="fl">50.</span><span class="op">)</span></span>
<span><span class="va">ifrLons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">140.</span>, <span class="op">-</span><span class="fl">110.</span><span class="op">)</span></span>
<span><span class="va">ifrDepth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">75.</span>, <span class="fl">75.</span><span class="op">)</span></span>
<span><span class="va">dataInfo</span> <span class="op">&lt;-</span> <span class="fu">rerddap</span><span class="fu">::</span><span class="fu"><a href="../reference/info.html">info</a></span><span class="op">(</span><span class="st">"CORIOLIS_GLOBAL_NRTOA_OBS_TIME_SERIE_PSAL"</span>, url <span class="op">=</span> <span class="va">urlBase</span><span class="op">)</span></span>
<span><span class="va">ifrPSAL</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/griddap.html">griddap</a></span><span class="op">(</span><span class="va">dataInfo</span>, longitude <span class="op">=</span> <span class="va">ifrLons</span>, latitude <span class="op">=</span> <span class="va">ifrLats</span>, time <span class="op">=</span> <span class="va">ifrTimes</span>, depth <span class="op">=</span> <span class="va">ifrDepth</span>,  fields <span class="op">=</span> <span class="va">parameter</span>, url <span class="op">=</span> <span class="va">urlBase</span><span class="op">)</span></span></code></pre></div>
<p>The <code>ggplot2</code> function <code>geom_raster()</code> is not designed for unevenly spaced coordinates, as are the latitudes from this model. The function <code>interp()</code> from the package <code>akima</code> is used to interpolate the data which are then plotted.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## ggplot2 has trouble with unequal y's</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st">"akima"</span><span class="op">)</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org" class="external-link">"dplyr"</a></span><span class="op">)</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st">"mapdata"</span><span class="op">)</span></span>
<span>  <span class="va">xlim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">140</span>, <span class="op">-</span><span class="fl">110</span><span class="op">)</span></span>
<span>  <span class="va">ylim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">51</span><span class="op">)</span></span>
<span><span class="co">## ggplot2 has trouble with unequal y's</span></span>
<span>  <span class="va">my.col</span> <span class="op">&lt;-</span> <span class="va">colors</span><span class="op">$</span><span class="va">salinity</span></span>
<span>  <span class="va">tempData1</span> <span class="op">&lt;-</span> <span class="va">ifrPSAL</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">PSAL</span></span>
<span>  <span class="va">tempData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">tempData1</span> , <span class="fl">61</span> <span class="op">*</span> <span class="fl">54</span><span class="op">)</span></span>
<span>  <span class="va">tempFrame</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ifrPSAL</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">longitude</span>, y <span class="op">=</span> <span class="va">ifrPSAL</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">latitude</span><span class="op">)</span></span>
<span>  <span class="va">tempFrame</span><span class="op">$</span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">tempData</span></span>
<span>  <span class="va">tempFrame1</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tempFrame</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.nan</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">myinterp</span> <span class="op">&lt;-</span> <span class="fu">akima</span><span class="fu">::</span><span class="fu">interp</span><span class="op">(</span><span class="va">tempFrame1</span><span class="op">$</span><span class="va">x</span>, <span class="va">tempFrame1</span><span class="op">$</span><span class="va">y</span>, <span class="va">tempFrame1</span><span class="op">$</span><span class="va">temp</span>, xo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">tempFrame1</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">tempFrame1</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, length <span class="op">=</span> <span class="fl">61</span><span class="op">)</span>, yo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">tempFrame1</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">tempFrame1</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, length <span class="op">=</span> <span class="fl">54</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">myinterp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">myinterp</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">myinterp</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span>  <span class="va">myinterp1</span><span class="op">$</span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">myinterp</span><span class="op">$</span><span class="va">z</span>, <span class="fl">61</span> <span class="op">*</span> <span class="fl">54</span><span class="op">)</span></span>
<span>  <span class="va">w</span> <span class="op">&lt;-</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">"worldHires"</span>, ylim <span class="op">=</span> <span class="va">ylim</span>, xlim <span class="op">=</span> <span class="va">xlim</span><span class="op">)</span></span>
<span> <span class="va">myplot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">myinterp1</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">temp</span><span class="op">)</span>, interpolate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="va">w</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_fill_gradientn</span><span class="op">(</span>colours <span class="op">=</span> <span class="va">my.col</span>, na.value <span class="op">=</span> <span class="cn">NA</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">32</span>, <span class="fl">35</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"salinity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"latitude"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"longitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_fixed</span><span class="op">(</span><span class="fl">1.3</span>, xlim <span class="op">=</span> <span class="va">xlim</span>, ylim <span class="op">=</span> <span class="va">ylim</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"salinity at 75 meters"</span>,<span class="va">ifrPSAL</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">time</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">)</span><span class="op">)</span></span>
<span> <span class="va">myplot</span></span></code></pre></div>
<p><img src="ifrPSA.png"></p>
</div>
</div>
<div class="section level2">
<h2 id="tabledap">tabledap<a class="anchor" aria-label="anchor" href="#tabledap"></a>
</h2>
<div class="section level3">
<h3 id="calcofi-data">CalCOFI data<a class="anchor" aria-label="anchor" href="#calcofi-data"></a>
</h3>
<p>CalCOFI (California Cooperative Oceanic Fisheries Investigations - <a href="https://calcofi.org" class="external-link uri">https://calcofi.org</a>) is a multi-agency partnership formed in 1949 to investigate the collapse of the sardine population off California. The organization’s members are from NOAA Fisheries Service, Scripps Institution of Oceanography, and California Department of Fish and Wildlife. The scope of this research has evolved into the study of marine ecosystems off California and the management of its fisheries resources. The nearly complete CalCOFI data, both physical and biological, are available through <span style="color:red">ERDDAP</span>.</p>
<p>The following example is a modification of a script developed by Dr. Andrew Leising of the Southwest Fisheries Science Center. The original script has been used to automate the generation of several yearly reports about the California Current Ecosystem. The script gets chlorophyll data and a measure of primary productivity from the hydrocasts,and then calculates a seasoanlly adjusted chlorophyll anomaly as well as a seasonally adjusted primary productivity anomaly. The first step is to get the information about the particular dataset:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/rerddap/">"rerddap"</a></span><span class="op">)</span></span>
<span><span class="va">hydroInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/info.html">info</a></span><span class="op">(</span><span class="st">'siocalcofiHydroCast'</span><span class="op">)</span></span></code></pre></div>
<p>and then get the desired data from 1984 through 2014:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/rerddap/">"rerddap"</a></span><span class="op">)</span></span>
<span><span class="va">calcofi.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tabledap.html">tabledap</a></span><span class="op">(</span><span class="va">hydroInfo</span>, fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'cst_cnt'</span>,  <span class="st">'date'</span>, <span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'julian_date'</span>, <span class="st">'julian_day'</span>, <span class="st">'rpt_line'</span>, <span class="st">'rpt_sta'</span>, <span class="st">'cruz_num'</span>, <span class="st">'intchl'</span>, <span class="st">'intc14'</span>, <span class="st">'time'</span><span class="op">)</span>, <span class="st">'time&gt;=1984-01-01T00:00:00Z'</span>, <span class="st">'time&lt;=2014-04-17T05:35:00Z'</span><span class="op">)</span></span></code></pre></div>
<p>Both “intchl” and “intC14” are returned as character strings, and are easier to work with as numbers:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">'rerddap'</span><span class="op">)</span> <span class="op">&lt;</span> <span class="st">'1.1.0'</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">calcofi.df</span><span class="op">$</span><span class="va">cruz_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">calcofi.df</span><span class="op">$</span><span class="va">cruz_num</span><span class="op">)</span></span>
<span>    <span class="va">calcofi.df</span><span class="op">$</span><span class="va">intc14</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">calcofi.df</span><span class="op">$</span><span class="va">intc14</span><span class="op">)</span></span>
<span>    <span class="va">calcofi.df</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">calcofi.df</span><span class="op">$</span><span class="va">time</span>, origin <span class="op">=</span> <span class="st">'1970-01-01'</span>, tz <span class="op">=</span> <span class="st">"GMT"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>At this point the requested data are in the <span style="color:red">R</span> workspace - the rest of the code performs the calculations to derive the seasonally adjusted values and plot them.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org" class="external-link">"dplyr"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate cruise means</span></span>
<span><span class="va">by_cruznum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">calcofi.df</span>, <span class="va">cruz_num</span><span class="op">)</span></span>
<span><span class="va">tempData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">by_cruznum</span>, <span class="va">year</span>, <span class="va">month</span>, <span class="va">cruz_num</span>, <span class="va">intchl</span>, <span class="va">intc14</span><span class="op">)</span></span>
<span><span class="va">CruiseMeans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span><span class="va">by_cruznum</span>, cruisechl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">intchl</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, cruisepp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">intc14</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">year</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">month</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tempTimes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">CruiseMeans</span><span class="op">$</span><span class="va">year</span>,<span class="st">'-'</span>,<span class="va">CruiseMeans</span><span class="op">$</span><span class="va">month</span>,<span class="st">'-1'</span><span class="op">)</span></span>
<span><span class="va">cruisetimes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">tempTimes</span>, origin <span class="op">=</span> <span class="st">'1970-01-01'</span>, tz <span class="op">=</span> <span class="st">"GMT"</span><span class="op">)</span></span>
<span><span class="va">CruiseMeans</span><span class="op">$</span><span class="va">cruisetimes</span> <span class="op">&lt;-</span> <span class="va">cruisetimes</span></span>
<span><span class="co"># calculate monthly "climatologies"</span></span>
<span><span class="va">byMonth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">CruiseMeans</span>, <span class="va">month</span><span class="op">)</span></span>
<span><span class="va">climate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span><span class="va">byMonth</span>, ppClimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cruisepp</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, chlaClimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cruisechl</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># calculate anomalies</span></span>
<span><span class="va">CruiseMeans</span><span class="op">$</span><span class="va">chlanom</span> <span class="op">&lt;-</span> <span class="va">CruiseMeans</span><span class="op">$</span><span class="va">cruisechl</span> <span class="op">-</span> <span class="va">climate</span><span class="op">$</span><span class="va">chlaClimate</span><span class="op">[</span><span class="va">CruiseMeans</span><span class="op">$</span><span class="va">month</span><span class="op">]</span></span>
<span><span class="va">CruiseMeans</span><span class="op">$</span><span class="va">ppanom</span> <span class="op">&lt;-</span> <span class="va">CruiseMeans</span><span class="op">$</span><span class="va">cruisepp</span> <span class="op">-</span> <span class="va">climate</span><span class="op">$</span><span class="va">ppClimate</span><span class="op">[</span><span class="va">CruiseMeans</span><span class="op">$</span><span class="va">month</span><span class="op">]</span></span>
<span><span class="co"># calculate mean yearly anomaly</span></span>
<span><span class="va">byYear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">CruiseMeans</span>, <span class="va">year</span><span class="op">)</span></span>
<span><span class="va">tempData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">CruiseMeans</span>, <span class="va">year</span>, <span class="va">chlanom</span>, <span class="va">ppanom</span> <span class="op">)</span></span>
<span><span class="va">byYear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">tempData</span>, <span class="va">year</span><span class="op">)</span></span>
<span><span class="va">yearlyAnom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span><span class="va">byYear</span>, ppYrAnom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ppanom</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, chlYrAnom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">chlanom</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">yearlyAnom</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html" class="external-link">ISOdate</a></span><span class="op">(</span><span class="va">yearlyAnom</span><span class="op">$</span><span class="va">year</span>, <span class="fl">01</span>, <span class="fl">01</span>, hour <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">yearlyAnom</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">year</span>, <span class="va">chlYrAnom</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">'yearly chla anom'</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">yearlyAnom</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">year</span>, <span class="va">ppYrAnom</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">'yearly pp anom'</span><span class="op">)</span></span></code></pre></div>
<p><img src="calCOFIPlot-1.png"><img src="calCOFIPlot-2.png"></p>
</div>
<div class="section level3">
<h3 id="cps-trawl-surveys">CPS Trawl Surveys<a class="anchor" aria-label="anchor" href="#cps-trawl-surveys"></a>
</h3>
<p>The CPS (Coastal Pelagic Species) Trawl Life History Length Frequency Data contains the length distribution of a subset of individuals from a species (mainly non-target) caught during SWFSC-FRD fishery independent trawl surveys of coastal pelagic species. Measured lengths for indicated length type (fork, standard, total, or mantle) were grouped in 10 mm bins (identified by the midpoint of the length class) and counts are recorded by sex.</p>
<p>The number and location of sardines (Sardinops sagax) in the tows in March 2010 and 2011 are extracted, and compared with monthly SST from satellites. First, query the <span style="color:red">ERDDAP</span> server to see if CPS Trawl data are available through the <span style="color:red">ERDDAP</span> server, and if so, obtain the datasetID for the dataset.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/rerddap/">"rerddap"</a></span><span class="op">)</span></span>
<span><span class="va">CPSquery</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ed_search.html">ed_search</a></span><span class="op">(</span>query <span class="op">=</span> <span class="st">'CPS Trawl'</span><span class="op">)</span></span>
<span><span class="va">CPSquery</span><span class="op">$</span><span class="va">alldata</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">summary</span></span>
<span><span class="va">CPSquery</span><span class="op">$</span><span class="va">alldata</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">tabledap</span></span>
<span><span class="va">CPSquery</span><span class="op">$</span><span class="va">alldata</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">dataset_id</span></span></code></pre></div>
<p>Then get the information for the CPS dataset:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/rerddap/">"rerddap"</a></span><span class="op">)</span></span>
<span><span class="va">CPSinfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/info.html">info</a></span><span class="op">(</span><span class="st">'FRDCPSTrawlLHHaulCatch'</span><span class="op">)</span></span></code></pre></div>
<p>extract the desired CPS data:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org" class="external-link">"dplyr"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/rerddap/">"rerddap"</a></span><span class="op">)</span></span>
<span><span class="va">sardines</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tabledap.html">tabledap</a></span><span class="op">(</span><span class="va">CPSinfo</span>, fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'latitude'</span>,  <span class="st">'longitude'</span>, <span class="st">'time'</span>, <span class="st">'scientific_name'</span>, <span class="st">'subsample_count'</span><span class="op">)</span>, <span class="st">'time&gt;=2010-01-01'</span>, <span class="st">'time&lt;=2012-01-01'</span>, <span class="st">'scientific_name="Sardinops sagax"'</span> <span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">'rerddap'</span><span class="op">)</span> <span class="op">&lt;</span> <span class="st">'1.1.0'</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">sardines</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">sardines</span><span class="op">$</span><span class="va">time</span>, origin <span class="op">=</span> <span class="st">'1970-01-01'</span>, tz <span class="op">=</span> <span class="st">"GMT"</span><span class="op">)</span></span>
<span>    <span class="va">sardines</span><span class="op">$</span><span class="va">latitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sardines</span><span class="op">$</span><span class="va">latitude</span><span class="op">)</span></span>
<span>    <span class="va">sardines</span><span class="op">$</span><span class="va">longitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sardines</span><span class="op">$</span><span class="va">longitude</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">sardines</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">sardines</span><span class="op">$</span><span class="va">time</span>, origin <span class="op">=</span> <span class="st">'1970-01-01'</span>, tz <span class="op">=</span> <span class="st">"GMT"</span><span class="op">)</span></span>
<span><span class="va">sardines</span><span class="op">$</span><span class="va">latitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sardines</span><span class="op">$</span><span class="va">latitude</span><span class="op">)</span></span>
<span><span class="va">sardines</span><span class="op">$</span><span class="va">longitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sardines</span><span class="op">$</span><span class="va">longitude</span><span class="op">)</span></span>
<span><span class="va">sardine2010</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sardines</span>, <span class="va">time</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2010-12-01'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>and plot the data versus monthly SST values:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get the dataset info</span></span>
<span><span class="va">sstInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/info.html">info</a></span><span class="op">(</span><span class="st">'erdMWsstdmday'</span><span class="op">)</span></span>
<span><span class="co"># get 201004 monthly sst</span></span>
<span><span class="va">sst201004</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/griddap.html">griddap</a></span><span class="op">(</span><span class="st">'erdMWsstdmday'</span>, latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">22.</span>, <span class="fl">51.</span><span class="op">)</span>, longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">220.</span>, <span class="fl">255</span><span class="op">)</span>, time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'2010-04-16'</span>,<span class="st">'2010-04-16'</span><span class="op">)</span>, fields <span class="op">=</span> <span class="st">'sst'</span><span class="op">)</span></span>
<span><span class="co"># get 201104 monthly sst</span></span>
<span><span class="va">sst201104</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/griddap.html">griddap</a></span><span class="op">(</span><span class="st">'erdMWsstdmday'</span>, latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">22.</span>, <span class="fl">51.</span><span class="op">)</span>, longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">220.</span>, <span class="fl">255</span><span class="op">)</span>, time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'2011-04-16'</span>,<span class="st">'2011-04-16'</span><span class="op">)</span>, fields <span class="op">=</span> <span class="st">'sst'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get polygons of coast for this area</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">"worldHires"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">22.</span>, <span class="fl">51.</span><span class="op">)</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">220</span> <span class="op">-</span> <span class="fl">360</span>, <span class="fl">250</span> <span class="op">-</span> <span class="fl">360</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># plot 201004 sst on the map</span></span>
<span><span class="va">sardine2010</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sardines</span>, <span class="va">time</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2010-12-01'</span>, origin <span class="op">=</span> <span class="st">'1970-01-01'</span>, tz <span class="op">=</span> <span class="st">"GMT"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sardine2011</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sardines</span>, <span class="va">time</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2010-12-01'</span>, origin <span class="op">=</span> <span class="st">'1970-01-01'</span>, tz <span class="op">=</span> <span class="st">"GMT"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mycolor</span> <span class="op">&lt;-</span> <span class="va">colors</span><span class="op">$</span><span class="va">temperature</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="va">w</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sst201004</span><span class="op">$</span><span class="va">data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="op">(</span><span class="va">longitude</span> <span class="op">-</span> <span class="fl">360</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">latitude</span>, fill <span class="op">=</span> <span class="va">sst</span><span class="op">)</span>, interpolate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>colours <span class="op">=</span> <span class="va">mycolor</span>, na.value <span class="op">=</span> <span class="cn">NA</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"latitude"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"longitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_fixed</span><span class="op">(</span><span class="fl">1.3</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">220</span> <span class="op">-</span> <span class="fl">360</span>, <span class="fl">250</span> <span class="op">-</span> <span class="fl">360</span><span class="op">)</span>,  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">22.</span>, <span class="fl">51.</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot 201104 sst on the map</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="va">w</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sst201104</span><span class="op">$</span><span class="va">data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="op">(</span><span class="va">longitude</span> <span class="op">-</span> <span class="fl">360</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">latitude</span>, fill <span class="op">=</span> <span class="va">sst</span><span class="op">)</span>, interpolate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sardine2011</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span>, colour <span class="op">=</span> <span class="va">subsample_count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>colours <span class="op">=</span> <span class="va">mycolor</span>, na.value <span class="op">=</span> <span class="cn">NA</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"latitude"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"longitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_fixed</span><span class="op">(</span><span class="fl">1.3</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">220</span> <span class="op">-</span> <span class="fl">360</span>, <span class="fl">250</span> <span class="op">-</span> <span class="fl">360</span><span class="op">)</span>,  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">22.</span>, <span class="fl">51.</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sardine2010</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span>, colour <span class="op">=</span> <span class="va">subsample_count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_colour_gradient</span><span class="op">(</span>space <span class="op">=</span> <span class="st">"Lab"</span>, na.value <span class="op">=</span> <span class="cn">NA</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">80</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">+</span>   <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sardine2011</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span>, colour <span class="op">=</span> <span class="va">subsample_count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_colour_gradient</span><span class="op">(</span>space <span class="op">=</span> <span class="st">"Lab"</span>, na.value <span class="op">=</span> <span class="cn">NA</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">80</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="CPSPlot-1.png"><img src="CPSPlot-2.png"></p>
<p>Also of interest is the distribution of sardines through the years:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sardinops</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tabledap.html">tabledap</a></span><span class="op">(</span><span class="va">CPSinfo</span>, fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'longitude'</span>, <span class="st">'latitude'</span>, <span class="st">'time'</span><span class="op">)</span>,  <span class="st">'scientific_name="Sardinops sagax"'</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">'rerddap'</span><span class="op">)</span> <span class="op">&lt;</span> <span class="st">'1.1.0'</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">sardinops</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">sardinops</span><span class="op">$</span><span class="va">time</span>, origin <span class="op">=</span> <span class="st">'1970-01-01'</span>, tz <span class="op">=</span> <span class="st">"GMT"</span><span class="op">)</span></span>
<span>    <span class="va">sardinops</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">sardinops</span><span class="op">$</span><span class="va">time</span>, <span class="st">'%Y'</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">sardinops</span><span class="op">$</span><span class="va">latitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sardinops</span><span class="op">$</span><span class="va">latitude</span><span class="op">)</span></span>
<span>    <span class="va">sardinops</span><span class="op">$</span><span class="va">longitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sardinops</span><span class="op">$</span><span class="va">longitude</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">sardinops</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">sardinops</span><span class="op">$</span><span class="va">time</span>, <span class="st">'%Y'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">135</span>, <span class="op">-</span><span class="fl">110</span><span class="op">)</span></span>
<span><span class="va">ylim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">51</span><span class="op">)</span></span>
<span><span class="va">coast</span> <span class="op">&lt;-</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">"worldHires"</span>, ylim <span class="op">=</span> <span class="va">ylim</span>, xlim <span class="op">=</span> <span class="va">xlim</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sardinops</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span>, colour <span class="op">=</span> <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="va">coast</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"latitude"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"longitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_fixed</span><span class="op">(</span><span class="fl">1.3</span>, xlim <span class="op">=</span> <span class="va">xlim</span>, ylim <span class="op">=</span> <span class="va">ylim</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Location of sardines by year in EPM Trawls"</span><span class="op">)</span></span></code></pre></div>
<p><img src="sardines.png"></p>
</div>
<div class="section level3">
<h3 id="ndbc-buoys">NDBC Buoys<a class="anchor" aria-label="anchor" href="#ndbc-buoys"></a>
</h3>
<p>NOAA’s National Data Buoy Center (NDBC) collects world-wide data from buoys in the ocean. <span style="color:red">ERDDAP</span> can be searched for the location of all buoys in a bounding box with latitudes(37N, 47N) and longitudes (124W, 121W) and the results plotted:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get location and station ID of NDBC buoys in a region</span></span>
<span><span class="va">BuoysInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/info.html">info</a></span><span class="op">(</span><span class="st">'cwwcNDBCMet'</span><span class="op">)</span></span>
<span><span class="va">locationBuoys</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tabledap.html">tabledap</a></span><span class="op">(</span><span class="va">BuoysInfo</span>, distinct <span class="op">=</span> <span class="cn">TRUE</span>, fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"station"</span>, <span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, <span class="st">"longitude&gt;=-124"</span>, <span class="st">"longitude&lt;=-121"</span>, <span class="st">"latitude&gt;=37"</span>, <span class="st">"latitude&lt;=47"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">'rerddap'</span><span class="op">)</span> <span class="op">&lt;</span> <span class="st">'1.1.0'</span><span class="op">)</span> <span class="op">{</span></span>
<span>   <span class="va">locationBuoys</span><span class="op">$</span><span class="va">latitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">locationBuoys</span><span class="op">$</span><span class="va">latitude</span><span class="op">)</span></span>
<span>   <span class="va">locationBuoys</span><span class="op">$</span><span class="va">longitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">locationBuoys</span><span class="op">$</span><span class="va">longitude</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">130</span>, <span class="op">-</span><span class="fl">110</span><span class="op">)</span></span>
<span><span class="va">ylim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">35</span>, <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">coast</span> <span class="op">&lt;-</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">"worldHires"</span>, ylim <span class="op">=</span> <span class="va">ylim</span>, xlim <span class="op">=</span> <span class="va">xlim</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">locationBuoys</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span> , y <span class="op">=</span> <span class="va">latitude</span>, colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">station</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="va">coast</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"latitude"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"longitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">coord_fixed</span><span class="op">(</span><span class="fl">1.3</span>, xlim <span class="op">=</span> <span class="va">xlim</span>, ylim <span class="op">=</span> <span class="va">ylim</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Location of buoys in given region"</span><span class="op">)</span></span></code></pre></div>
<p><img src="NDBC.png"></p>
<p>Looking at wind speed for 2012 for station “46012”</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">buoyData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tabledap.html">tabledap</a></span><span class="op">(</span><span class="va">BuoysInfo</span>, fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"time"</span>, <span class="st">"wspd"</span><span class="op">)</span>, <span class="st">'station="46012"'</span>, <span class="st">'time&gt;=2012-01-01'</span>, <span class="st">'time&lt;=2013-01-01'</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">'rerddap'</span><span class="op">)</span> <span class="op">&lt;</span> <span class="st">'1.1.0'</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">buoyData</span><span class="op">$</span><span class="va">wspd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">buoyData</span><span class="op">$</span><span class="va">wspd</span><span class="op">)</span></span>
<span>    <span class="va">buoyData</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">buoyData</span><span class="op">$</span><span class="va">time</span>, origin <span class="op">=</span> <span class="st">'1970-01-01'</span>, tz <span class="op">=</span> <span class="st">"GMT"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">buoyData</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">time</span>, <span class="va">wspd</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"wind speed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Wind Speed in 2012 from buoy 46012 "</span><span class="op">)</span></span></code></pre></div>
<p><img src="NDBCTS.png"></p>
</div>
<div class="section level3">
<h3 id="ioos-glider-data">IOOS Glider Data<a class="anchor" aria-label="anchor" href="#ioos-glider-data"></a>
</h3>
<p>The mission of the IOOS Glider DAC is to provide glider operators with a simple process for submitting glider data sets to a centralized location, enabling the data to be visualized, analyzed, widely distributed via existing web services and the Global Telecommunications System (GTS) and archived at the National Centers for Environmental Information (NCEI). The IOOS Glider Dac is accessible through <code>rerddap</code> (<a href="https://gliders.ioos.us/erddap/index.html" class="external-link uri">https://gliders.ioos.us/erddap/index.html</a>). Extracting and plotting salinity from part of the path of one glider deployed by the Scripps Institution of Oceanography:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urlBase</span> <span class="op">&lt;-</span> <span class="st">"https://data.ioos.us/gliders/erddap/"</span></span>
<span><span class="va">gliderInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/info.html">info</a></span><span class="op">(</span><span class="st">"sp064-20161214T1913"</span>,  url <span class="op">=</span> <span class="va">urlBase</span><span class="op">)</span></span>
<span><span class="va">glider</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tabledap.html">tabledap</a></span><span class="op">(</span><span class="va">gliderInfo</span>, fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span>, <span class="st">"depth"</span>, <span class="st">"salinity"</span><span class="op">)</span>, <span class="st">'time&gt;=2016-12-14'</span>, <span class="st">'time&lt;=2016-12-23'</span>, url <span class="op">=</span> <span class="va">urlBase</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">'rerddap'</span><span class="op">)</span> <span class="op">&lt;</span> <span class="st">'1.1.0'</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">glider</span><span class="op">$</span><span class="va">longitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">glider</span><span class="op">$</span><span class="va">longitude</span><span class="op">)</span></span>
<span>    <span class="va">glider</span><span class="op">$</span><span class="va">latitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">glider</span><span class="op">$</span><span class="va">latitude</span><span class="op">)</span></span>
<span>    <span class="va">glider</span><span class="op">$</span><span class="va">depth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">glider</span><span class="op">$</span><span class="va">depth</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st">"plot3D"</span><span class="op">)</span></span>
<span><span class="fu">scatter3D</span><span class="op">(</span>x <span class="op">=</span> <span class="va">glider</span><span class="op">$</span><span class="va">longitude</span> , y <span class="op">=</span> <span class="va">glider</span><span class="op">$</span><span class="va">latitude</span> , z <span class="op">=</span> <span class="op">-</span><span class="va">glider</span><span class="op">$</span><span class="va">depth</span>, colvar <span class="op">=</span> <span class="va">glider</span><span class="op">$</span><span class="va">salinity</span>,              col <span class="op">=</span> <span class="va">colors</span><span class="op">$</span><span class="va">salinity</span>, phi <span class="op">=</span> <span class="fl">40</span>, theta <span class="op">=</span> <span class="fl">25</span>, bty <span class="op">=</span> <span class="st">"g"</span>, type <span class="op">=</span> <span class="st">"p"</span>,</span>
<span>           ticktype <span class="op">=</span> <span class="st">"detailed"</span>, pch <span class="op">=</span> <span class="fl">10</span>, clim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">33.2</span>,<span class="fl">34.31</span><span class="op">)</span>, clab <span class="op">=</span> <span class="st">'Salinity'</span>,</span>
<span>           xlab <span class="op">=</span> <span class="st">"longitude"</span>, ylab <span class="op">=</span> <span class="st">"latitude"</span>, zlab <span class="op">=</span> <span class="st">"depth"</span>,</span>
<span>           cex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="glider.png"></p>
</div>
</div>
<div class="section level2">
<h2 id="animal-telemetry-network-atn">Animal Telemetry Network (ATN)<a class="anchor" aria-label="anchor" href="#animal-telemetry-network-atn"></a>
</h2>
<p>The Integrated Ocean Observing System Animal Telemetry Network (IOOS ATN) is designed to serve as an access point to search, discover and access animal telemetry data, and associated oceanographic datasets, from a wide variety of species and platforms. The track of one of the tagged animals is extracted, and plotted with SST value from satellite along the track.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">atnURL</span> <span class="op">&lt;-</span> <span class="st">'https://oceanview.pfeg.noaa.gov/erddap/'</span></span>
<span><span class="va">atnInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/info.html">info</a></span><span class="op">(</span><span class="st">'gtoppAT'</span>, url <span class="op">=</span> <span class="va">atnURL</span><span class="op">)</span></span>
<span><span class="va">atnData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tabledap.html">tabledap</a></span><span class="op">(</span><span class="va">atnInfo</span>, fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"time"</span>, <span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, <span class="st">'toppID="1807001"'</span>, url <span class="op">=</span> <span class="va">atnURL</span><span class="op">)</span></span>
<span><span class="va">atnData</span><span class="op">$</span><span class="va">latitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">atnData</span><span class="op">$</span><span class="va">latitude</span><span class="op">)</span></span>
<span><span class="va">atnData</span><span class="op">$</span><span class="va">longitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">atnData</span><span class="op">$</span><span class="va">longitude</span><span class="op">)</span></span>
<span><span class="va">ncdcSST</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="cn">NA_real_</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">atnData</span><span class="op">$</span><span class="va">time</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ncdcSSTInfo</span> <span class="op">=</span> <span class="fu"><a href="../reference/info.html">info</a></span><span class="op">(</span><span class="st">'ncdcOisst2Agg'</span><span class="op">)</span></span>
<span><span class="va">time_bound</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">atnData</span><span class="op">$</span><span class="va">time</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">atnData</span><span class="op">$</span><span class="va">time</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">atnData</span><span class="op">$</span><span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/griddap.html">griddap</a></span><span class="op">(</span><span class="va">ncdcSSTInfo</span>, </span>
<span>                     fields <span class="op">=</span> <span class="st">'sst'</span>, </span>
<span>                     latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">atnData</span><span class="op">$</span><span class="va">latitude</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">atnData</span><span class="op">$</span><span class="va">latitude</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                     longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">atnData</span><span class="op">$</span><span class="va">longitude</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">atnData</span><span class="op">$</span><span class="va">longitude</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                     time <span class="op">=</span> <span class="va">time_bound</span></span>
<span>                     <span class="op">)</span></span>
<span><span class="va">ncdcSST</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">extract</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">sst</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ylim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">32.5</span>, <span class="fl">34</span><span class="op">)</span></span>
<span><span class="va">xlim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">119</span>, <span class="op">-</span><span class="fl">116.5</span><span class="op">)</span></span>
<span><span class="va">mycolor</span> <span class="op">&lt;-</span> <span class="va">colors</span><span class="op">$</span><span class="va">temperature</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">"worldHires"</span>, ylim <span class="op">=</span> <span class="va">ylim</span>, xlim <span class="op">=</span> <span class="va">xlim</span><span class="op">)</span></span>
<span><span class="va">alldata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sst <span class="op">=</span> <span class="va">ncdcSST</span>, longitude <span class="op">=</span> <span class="va">atnData</span><span class="op">$</span><span class="va">longitude</span> <span class="op">-</span> <span class="fl">360</span>, latitude <span class="op">=</span> <span class="va">atnData</span><span class="op">$</span><span class="va">latitude</span><span class="op">)</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">alldata</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>colour <span class="op">=</span> <span class="va">sst</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span></span>
<span><span class="va">z</span> <span class="op">+</span> <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="va">w</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_gradientn</span><span class="op">(</span>colours <span class="op">=</span> <span class="va">mycolor</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">16.9</span>, <span class="fl">17.3</span><span class="op">)</span>, <span class="st">"SST"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_fixed</span><span class="op">(</span><span class="fl">1.3</span>, xlim <span class="op">=</span> <span class="va">xlim</span>, ylim <span class="op">=</span> <span class="va">ylim</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"SST Along Track"</span><span class="op">)</span></span></code></pre></div>
<p><img src="atn.png"></p>
</div>
<div class="section level2">
<h2 id="california-current-system-integrated-ecosystem-assessment-ccsiea">California Current System Integrated Ecosystem Assessment (CCSIEA)<a class="anchor" aria-label="anchor" href="#california-current-system-integrated-ecosystem-assessment-ccsiea"></a>
</h2>
<p>The primary goals of the CCIEA are to better understand the web of interactions that drive patterns and trends of components within the California Current ecosystem, and forecast how changing environmental conditions and management actions affect the status of these components. The conceptual model of the social-ecological system of the California Current illustrates how humans and their social systems are inextricably linked to these marine, coastal, and upland environments (see (“www.integratedecosystemassessment.noaa.gov/regions/california-current/projects”).</p>
<p>The over 300 indices developed for the CCSIEA are available through <code>rerddap</code>. Here an index of coho abundance in California is compared with the February value of an index of the strength and location of the North Pacific High, developed in “The North Pacific High and wintertime pre-conditioning of California current productivity” by Schroeder et al. (Geophys. Res. Lett., 40, 541–546).</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urlBase</span> <span class="op">&lt;-</span> <span class="st">'https://coastwatch.pfeg.noaa.gov/erddap/'</span></span>
<span><span class="va">nphInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/info.html">info</a></span><span class="op">(</span><span class="st">'erdNph'</span>, url <span class="op">=</span> <span class="va">urlBase</span><span class="op">)</span></span>
<span><span class="va">nphData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tabledap.html">tabledap</a></span><span class="op">(</span><span class="va">nphInfo</span>, fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"maxSLP"</span> <span class="op">)</span>, <span class="st">'month=2'</span>, <span class="st">'year&gt;=1987'</span>, url <span class="op">=</span> <span class="va">urlBase</span><span class="op">)</span></span>
<span><span class="va">nphData</span><span class="op">$</span><span class="va">maxSLP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">nphData</span><span class="op">$</span><span class="va">maxSLP</span><span class="op">)</span></span>
<span><span class="va">urlBase</span> <span class="op">&lt;-</span> <span class="st">'https://oceanview.pfeg.noaa.gov/erddap/'</span></span>
<span><span class="va">cohoInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/info.html">info</a></span><span class="op">(</span><span class="st">'cciea_SM_CA_CO_ABND'</span>, url <span class="op">=</span> <span class="va">urlBase</span><span class="op">)</span></span>
<span><span class="va">cohoData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tabledap.html">tabledap</a></span><span class="op">(</span><span class="va">cohoInfo</span>, fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"abundance_anomaly"</span>, <span class="st">"time"</span><span class="op">)</span>,  url <span class="op">=</span> <span class="va">urlBase</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">'rerddap'</span><span class="op">)</span> <span class="op">&lt;</span> <span class="st">'1.1.0'</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">cohoData</span><span class="op">$</span><span class="va">abundance_anomaly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">cohoData</span><span class="op">$</span><span class="va">abundance_anomaly</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">alldata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>coho <span class="op">=</span> <span class="va">cohoData</span><span class="op">$</span><span class="va">abundance_anomaly</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">27</span><span class="op">]</span>, maxSLP <span class="op">=</span> <span class="va">nphData</span><span class="op">$</span><span class="va">maxSLP</span>, year <span class="op">=</span> <span class="va">nphData</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">alldata</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">coho</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">'blue'</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"coho abundance anomaly"</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">alldata</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">maxSLP</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"MaxSLP"</span><span class="op">)</span></span></code></pre></div>
<p><img src="coho_anomaly.png"><img src="maxslp.png"></p>
</div>
<div class="section level2">
<h2 id="cacheing-last-now-idempotency-and-a-gotcha">Cacheing, “last”, “now”, idempotency, and a gotcha<a class="anchor" aria-label="anchor" href="#cacheing-last-now-idempotency-and-a-gotcha"></a>
</h2>
<p><code>rerddap</code> by default caches the requests you make, so that if you happen to make the same request again, the data is restored from the cache, rather than having to go out and retrieve it remotely. For most applications, this a boon (such as when “knitting” and “reknitting” this document), as it can speed things up when doing a lot of request in a script, and works because in most cases an <span style="color:red">ERDDAP</span> request is “idempotent”. This means that the the request will always return the same thing no matter what requests came before - it doesn’t depend on state. However this is not true if the script uses either “last” in <code><a href="../reference/griddap.html">griddap()</a></code> or “now” in <code><a href="../reference/tabledap.html">tabledap()</a></code> as these will return different values as time elapses and data are added to the datasets. While it is desirable to have <span style="color:red">ERDDAP</span> purely idempotent, the “last” and “now” constructs are very helpful for people using <span style="color:red">ERDDAP</span> in dashboards, webpages, regular input to models and the like, and the benefits far outweigh the problems. However, if you are using either “last” or “now” in an <code>rerddap</code> based script, you want to be very careful to clear the <code>rerddap</code> cache, otherwise the request will be viewed as the same, and the data from the last request, rather than the latest data, will be returned. Note that several examples in this vignette use “last”, and therefore the graphics may look different depending on when you “knitted” the vignette.</p>
<p>For help in dealing with the cache, see:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">cache_delete</span></span>
<span><span class="op">?</span><span class="va">cache_delete_all</span></span>
<span><span class="op">?</span><span class="va">cache_details</span></span>
<span><span class="op">?</span><span class="va">cache_list</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="ncdf4">Reading data from a netCDF file.<a class="anchor" aria-label="anchor" href="#ncdf4"></a>
</h2>
<p>Here we give a brief summary of how to read in part of the data from a netCDF file. The basic steps are:</p>
<ul>
<li>Open the netCDF file</li>
<li>Map coordinate values to array indices</li>
<li>Extract the data</li>
</ul>
<p>A sample netCDF file, “MWsstd1day.nc” is included. This is a small file and is a toy example, but the basic principles remain the same for a larger file.</p>
<p>Open the netCDF file:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://cirrus.ucsd.edu/~pierce/ncdf/" class="external-link">"ncdf4"</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: ncdf4</span></span>
<span><span class="va">exampleFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"MWsstd1day.nc"</span>, package <span class="op">=</span> <span class="st">"rerddap"</span><span class="op">)</span></span>
<span><span class="va">sstFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/nc_open.html" class="external-link">nc_open</a></span><span class="op">(</span><span class="va">exampleFile</span><span class="op">)</span></span></code></pre></div>
<p>While it is possible to obtain the coordinate values by extracting them from the file, <code>ncdf4</code> by default does so automatically in <code>nc_open</code>. The names of the coordinate dimensions can be found from:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sstFile</span><span class="op">$</span><span class="va">dim</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "time"      "altitude"  "latitude"  "longitude"</span></span></code></pre></div>
<p>(note that the coordinate names here are given in ‘C’ order, while for an extract the coordinates will be in the opposite, “Fortran” order) and the values of any coordinate, say longitude, can be found from:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sstFile</span><span class="op">$</span><span class="va">dim</span><span class="op">$</span><span class="va">longitude</span><span class="op">$</span><span class="va">vals</span></span>
<span><span class="co">#&gt;  [1] 210.0000 210.0125 210.0250 210.0375 210.0500 210.0625 210.0750 210.0875</span></span>
<span><span class="co">#&gt;  [9] 210.1000 210.1125 210.1250 210.1375 210.1500 210.1625 210.1750 210.1875</span></span>
<span><span class="co">#&gt; [17] 210.2000 210.2125 210.2250 210.2375 210.2500 210.2625 210.2750 210.2875</span></span>
<span><span class="co">#&gt; [25] 210.3000 210.3125 210.3250 210.3375 210.3500 210.3625 210.3750 210.3875</span></span>
<span><span class="co">#&gt; [33] 210.4000 210.4125 210.4250 210.4375 210.4500 210.4625 210.4750 210.4875</span></span>
<span><span class="co">#&gt; [41] 210.5000 210.5125 210.5250 210.5375 210.5500 210.5625 210.5750 210.5875</span></span>
<span><span class="co">#&gt; [49] 210.6000 210.6125 210.6250 210.6375 210.6500 210.6625 210.6750 210.6875</span></span>
<span><span class="co">#&gt; [57] 210.7000 210.7125 210.7250 210.7375 210.7500 210.7625 210.7750 210.7875</span></span>
<span><span class="co">#&gt; [65] 210.8000 210.8125 210.8250 210.8375 210.8500 210.8625 210.8750 210.8875</span></span>
<span><span class="co">#&gt; [73] 210.9000 210.9125 210.9250 210.9375 210.9500 210.9625 210.9750 210.9875</span></span>
<span><span class="co">#&gt; [81] 211.0000</span></span></code></pre></div>
<p>The names of the variables in the netCDF file can be found from:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sstFile</span><span class="op">$</span><span class="va">var</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "sst"</span></span></code></pre></div>
<p>An extract is done by giving the pointer to the netCDF file (“sstFile” in this instance), the name of the variable ot be extracted (“sst” in this instance), the starting index value (in array coordinates) for each dimension, and the the count (the number of other index values) to include. If all values of a particular dimension are wanted, then “-1” can be used for the count. So for example to extract all of the values for the first day:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://cirrus.ucsd.edu/~pierce/ncdf/" class="external-link">"ncdf4"</a></span><span class="op">)</span></span>
<span><span class="va">day1SST</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncvar_get.html" class="external-link">ncvar_get</a></span><span class="op">(</span><span class="va">sstFile</span>, <span class="st">"sst"</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Suppose we only want the latitudes from (30.0, 30.5) and longitudes (210.0, 210.5) for the first day. We need to find the array indices that match those coordinate values:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">latMin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">sstFile</span><span class="op">$</span><span class="va">dim</span><span class="op">$</span><span class="va">latitude</span><span class="op">$</span><span class="va">vals</span> <span class="op">==</span> <span class="fl">30.0</span><span class="op">)</span></span>
<span><span class="va">latMax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">sstFile</span><span class="op">$</span><span class="va">dim</span><span class="op">$</span><span class="va">latitude</span><span class="op">$</span><span class="va">vals</span> <span class="op">==</span> <span class="fl">30.5</span><span class="op">)</span></span>
<span><span class="va">lonMin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">sstFile</span><span class="op">$</span><span class="va">dim</span><span class="op">$</span><span class="va">longitude</span><span class="op">$</span><span class="va">vals</span> <span class="op">==</span> <span class="fl">210.0</span><span class="op">)</span></span>
<span><span class="va">lonMax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">sstFile</span><span class="op">$</span><span class="va">dim</span><span class="op">$</span><span class="va">longitude</span><span class="op">$</span><span class="va">vals</span> <span class="op">==</span> <span class="fl">210.5</span><span class="op">)</span></span></code></pre></div>
<p>and then extract the data:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://cirrus.ucsd.edu/~pierce/ncdf/" class="external-link">"ncdf4"</a></span><span class="op">)</span></span>
<span><span class="va">day1SST</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncvar_get.html" class="external-link">ncvar_get</a></span><span class="op">(</span><span class="va">sstFile</span>, <span class="st">"sst"</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lonMin</span>, <span class="va">latMin</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="op">(</span><span class="va">lonMax</span> <span class="op">-</span> <span class="va">lonMin</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>, <span class="op">(</span><span class="va">latMax</span> <span class="op">-</span> <span class="va">latMin</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">1</span> <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>If we wanted a time series at (30N, 210E) it would be:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://cirrus.ucsd.edu/~pierce/ncdf/" class="external-link">"ncdf4"</a></span><span class="op">)</span></span>
<span><span class="va">day1SST</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncvar_get.html" class="external-link">ncvar_get</a></span><span class="op">(</span><span class="va">sstFile</span>, <span class="st">"sst"</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lonMax</span>, <span class="va">latMin</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span> <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>For this example, it is easy to visually peruse the dimension values but for a large extract this might not be the possible. Suppose we wanted all values in a latitude range or (30.1, 30.3) and since the range of values we are interested in might not be on a grid boundary we want the smallest range that would include these values (that is if not on the grid then the smallest value may be less than 30.1) and similarly for longitude, say (210.1, 210.3):</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">latMin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">sstFile</span><span class="op">$</span><span class="va">dim</span><span class="op">$</span><span class="va">latitude</span><span class="op">$</span><span class="va">vals</span> <span class="op">&lt;=</span> <span class="fl">30.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">latMax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">sstFile</span><span class="op">$</span><span class="va">dim</span><span class="op">$</span><span class="va">latitude</span><span class="op">$</span><span class="va">vals</span> <span class="op">&gt;=</span> <span class="fl">30.3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lonMin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">sstFile</span><span class="op">$</span><span class="va">dim</span><span class="op">$</span><span class="va">longitude</span><span class="op">$</span><span class="va">vals</span> <span class="op">&lt;=</span> <span class="fl">210.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lonMax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">sstFile</span><span class="op">$</span><span class="va">dim</span><span class="op">$</span><span class="va">longitude</span><span class="op">$</span><span class="va">vals</span> <span class="op">&gt;=</span> <span class="fl">210.3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>and then perform the extract as before:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://cirrus.ucsd.edu/~pierce/ncdf/" class="external-link">"ncdf4"</a></span><span class="op">)</span></span>
<span><span class="va">day1SST</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncvar_get.html" class="external-link">ncvar_get</a></span><span class="op">(</span><span class="va">sstFile</span>, <span class="st">"sst"</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lonMin</span>, <span class="va">latMin</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="op">(</span><span class="va">lonMax</span> <span class="op">-</span> <span class="va">lonMin</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>, <span class="op">(</span><span class="va">latMax</span> <span class="op">-</span> <span class="va">latMin</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">1</span> <span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
